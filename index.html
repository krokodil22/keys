<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</title>
  <style>
    :root{
      --bg:#f1f5f9; --panel:#ffffff; --text:#0f172a; --sub:#475569;
      --accent:#10b981; --violet:#7c3aed; --border:#e2e8f0; --pink:#ec4899;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto; color:var(--text); background:var(--bg); display:flex; flex-direction:column; align-items:center}
    .wrap{width:min(1100px,100%); padding:24px 16px; position:relative}
    header{display:flex; align-items:center; justify-content:space-between}
    h1{margin:0; font-size:28px}
    .tag{background:#f1f5f9; border:1px solid var(--border); padding:6px 10px; border-radius:12px; font-size:14px}
    .controls{display:flex; gap:8px; margin:14px 0 0 0; align-items:center; flex-wrap:wrap}
    .btn{border:none; border-radius:12px; padding:8px 12px; background:#111827; color:#fff; font-weight:600; cursor:pointer; position:relative}
    .btn.level-locked{background:#e5e7eb; color:#94a3b8}
    .btn.level-locked::after{content:"üîí"; position:absolute; right:8px; top:50%; transform:translateY(-50%); font-size:14px}
    .btn.level-passed{background:#bbf7d0; color:#065f46}
    .btn.level-current{background:#bfdbfe; color:#1e3a8a}
    .hint{font-size:12px; color:var(--sub)}
    .arena{position:relative; margin-top:18px; height:260px; border:1px solid var(--border); border-radius:18px; background:linear-gradient(90deg, #e2e8f0, #f8fafc); overflow:hidden}
    .fly{position:absolute; left:0; top:50%; transform:translateY(-50%); font-weight:900; font-size:46px; background:var(--violet); color:white; padding:10px 20px; border-radius:16px; box-shadow:0 10px 30px rgba(124,58,237,.25)}
    .arena-hint{position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:var(--sub); font-size:18px; opacity:.95; text-align:center; pointer-events:none}
    .overlay{position:absolute; inset:0; background:rgba(0,0,0,.4); display:none; align-items:center; justify-content:center}
    .card{background:#ffffff; color:#0f172a; border:1px solid var(--border); border-radius:16px; padding:20px; text-align:center}
    .kbd-outer{width:100%; display:flex; justify-content:center; overflow:visible}
    .kbd{margin:28px 0 10px; display:flex; flex-direction:column; gap:10px; align-items:center; width:920px; transform-origin: top center}
    .row{display:flex; gap:8px; justify-content:center; flex-wrap:nowrap}
    .key{min-width:42px; padding:10px 12px; text-align:center; border:1px solid var(--border); border-radius:14px; background:var(--panel); color:var(--text); cursor:pointer; user-select:none}
    .key:hover{background:#f1f5f9}
    .key.active{background:var(--violet); color:white; box-shadow:0 6px 20px rgba(124,58,237,.35); animation:pulse 1s infinite}
    .spacekey{min-width:260px}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
    .lives{display:flex; gap:8px; align-items:center}
    .heart{width:24px; height:24px; display:inline-flex; align-items:center; justify-content:center}
    .heart svg{width:24px; height:24px; display:block}
    .heart .shape{stroke:var(--pink); stroke-width:2; fill:none}
    .heart.filled .shape{fill:var(--pink)}
    .dino{position:fixed; bottom:0; pointer-events:none; user-select:none}
    .dino-left{left:0; width:180px}
    .dino-right{right:0; width:200px}
    @media (max-width:768px){.dino{display:none}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="display:flex; align-items:center; gap:10px">
        <img src="logo.webp" alt="logo" style="height:32px; width:auto" />
        <h1>–ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</h1>
      </div>
      <div style="display:flex; gap:12px; align-items:center">
        <div class="lives" id="lives"></div>
        <div class="tag" id="scoreTag">–û—á–∫–∏: 0</div>
      </div>
    </header>

    <div class="controls">
      <div>
        <button class="btn" data-level="1">–£—Ä–æ–≤–µ–Ω—å 1</button>
        <button class="btn" data-level="2">–£—Ä–æ–≤–µ–Ω—å 2</button>
        <button class="btn" data-level="3">–£—Ä–æ–≤–µ–Ω—å 3</button>
        <button class="btn" data-level="4">–£—Ä–æ–≤–µ–Ω—å 4</button>
        <button class="btn" data-level="5">–£—Ä–æ–≤–µ–Ω—å 5</button>
        <button class="btn" data-bonus="1">–ë–æ–Ω—É—Å ‚àû</button>
      </div>
      <div class="hint" id="setHint"></div>
    </div>

    <div class="arena" id="arena">
      <div class="arena-hint" id="arenaHint">–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –ü–†–û–ë–ï–õ</div>
      <div class="fly" id="fly" style="left:0">–§</div>
      <div class="overlay" id="over">
        <div class="card">
          <div id="overlayTitle" style="font-size:26px; font-weight:800; margin-bottom:6px; color:#0f172a;">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</div>
          <div id="finalScore" style="margin-bottom:12px">–í–∞—à —Å—á—ë—Ç: 0</div>
          <div style="display:flex; gap:8px; justify-content:center">
            <button class="btn" id="retryBtn">–°—ã–≥—Ä–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞</button>
            <button class="btn" id="nextBtn" style="display:none">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π</button>
          </div>
        </div>
      </div>
    </div>

    <div class="kbd-outer"><div class="kbd" id="kbd"></div></div>
    <img src="dino2.png" class="dino dino-left" alt="–î–∏–Ω–æ 2" />
    <img src="dino1.png" class="dino dino-right" alt="–î–∏–Ω–æ 1" />
  </div>

<script>
(function(){
  const RU_LAYOUT = [
    ["–Å","–ô","–¶","–£","–ö","–ï","–ù","–ì","–®","–©","–ó","–•","–™"],
    ["–§","–´","–í","–ê","–ü","–†","–û","–õ","–î","–ñ","–≠"],
    ["–Ø","–ß","–°","–ú","–ò","–¢","–¨","–ë","–Æ"]
  ];
  const BASE_EASY = ["–§","–´","–í","–ê","–ü","–û","–õ"];
  const EXTRA_EASY = ["–î","–ñ","–≠","–Ø","–ß"];
  const LEVEL_SIZES = {1:3,2:5,3:7,4:9,5:12};
  const SPEED = {1:80,2:95,3:110,4:130,5:150,6:160};

  function lettersForLevelNum(n){
    const all = BASE_EASY.concat(EXTRA_EASY);
    const size = LEVEL_SIZES[n] || all.length;
    return all.slice(0, size);
  }
  function lettersForPassed(unlocked){
    const u = Math.min(Math.max(unlocked,1),5);
    const size = LEVEL_SIZES[u];
    const all = BASE_EASY.concat(EXTRA_EASY);
    return all.slice(0, size);
  }
  function makeHeart(filled){
    const span = document.createElement('span');
    span.className='heart'+(filled?' filled':'');
    span.innerHTML = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">      <path class="shape" d="M12 21s-6.7-4.3-9.2-6.8C.2 11.6.2 8.4 2.8 5.8c2.1-2.1 5.6-2.1 7.7 0L12 7.4l1.5-1.5c2.1-2.1 5.6-2.1 7.7 0 2.6 2.6 2.6 5.8 0 8.3C18.7 16.7 12 21 12 21z"/>    </svg>';
    return span;
  }

  // DOM
  const fly = document.getElementById('fly');
  const arena = document.getElementById('arena');
  const livesEl = document.getElementById('lives');
  const scoreTag = document.getElementById('scoreTag');
  const overlay = document.getElementById('over');
  const overlayTitle = document.getElementById('overlayTitle');
  const finalScore = document.getElementById('finalScore');
  const retryBtn = document.getElementById('retryBtn');
  const nextBtn = document.getElementById('nextBtn');
  const setHint = document.getElementById('setHint');
  const kbd = document.getElementById('kbd');
  const arenaHint = document.getElementById('arenaHint');

  // Build keyboard
  const keyButtons = new Map();
  RU_LAYOUT.forEach(row => {
    const rowEl = document.createElement('div'); rowEl.className='row';
    row.forEach(k => {
      const b = document.createElement('button'); b.className='key'; b.textContent=k;
      b.addEventListener('click',()=>handleInput(k));
      rowEl.appendChild(b); keyButtons.set(k,b);
    }); kbd.appendChild(rowEl);
  });
  const spaceRow = document.createElement('div'); spaceRow.className='row';
  const spaceBtn = document.createElement('button'); spaceBtn.className='key spacekey'; spaceBtn.textContent='–ü—Ä–æ–±–µ–ª'; spaceBtn.id='spaceKey';
  spaceBtn.addEventListener('click',()=> start());
  spaceRow.appendChild(spaceBtn); kbd.appendChild(spaceRow);

  // Scale keyboard
  function applyKbdScale(){
    const outer = document.querySelector('.kbd-outer'); const inner = document.querySelector('.kbd');
    if(!outer||!inner) return; const available = outer.clientWidth; const base = 920;
    const s = Math.min(1, Math.max(0.6, available/base)); inner.style.transform = 'scale('+s+')';
  }
  window.addEventListener('resize', applyKbdScale); applyKbdScale();

  // State
  const START_LIVES=3, RIGHT_PAD=24;
  let level=1, isBonus=false, setLetters=lettersForLevelNum(1);
  let running=false, levelComplete=false, unlockedLevelMax=1;
  let x=0,lastTs=null,req=null,lives=START_LIVES,score=0,target=setLetters[0];

  // Persistence
  function saveProgress(){ try{ localStorage.setItem('kt_unlockedMax',String(unlockedLevelMax)); localStorage.setItem('kt_level',String(level)); }catch(e){} }
  function loadProgress(){ try{ const u=parseInt(localStorage.getItem('kt_unlockedMax')||'1',10); const lv=parseInt(localStorage.getItem('kt_level')||'1',10); if(!isNaN(u)) unlockedLevelMax=Math.min(Math.max(u,1),6); if(!isNaN(lv)) level=Math.min(Math.max(lv,1),5); }catch(e){} }

  // Lives
  function renderLives(){ livesEl.innerHTML=''; for(let i=0;i<START_LIVES;i++){ livesEl.appendChild(makeHeart(i<lives)); } }

  // Level buttons
  function updateLevelLocks(){
    document.querySelectorAll('[data-level]').forEach(btn=>{
      const lvl=+btn.dataset.level; btn.classList.remove('level-locked','level-passed','level-current');
      if(lvl > Math.min(unlockedLevelMax,5)){ btn.disabled=true; btn.classList.add('level-locked'); }
      else{ btn.disabled=false; if(lvl<level) btn.classList.add('level-passed'); else if(lvl===level && !isBonus) btn.classList.add('level-current'); }
    });
    const bonusBtn=document.querySelector('[data-bonus]');
    if(bonusBtn){ bonusBtn.classList.remove('level-locked','level-passed','level-current'); if(unlockedLevelMax>=6){ bonusBtn.disabled=false; isBonus?bonusBtn.classList.add('level-current'):bonusBtn.classList.add('level-passed'); } else { bonusBtn.disabled=true; bonusBtn.classList.add('level-locked'); } }
  }

  function up(s){ return (s||'').toLocaleUpperCase('ru'); }
  
  function highlight(){
    // Light up only when running; before start show only Space
    keyButtons.forEach((b,label)=>{
      if(running && !levelComplete && label===target) b.classList.add('active');
      else b.classList.remove('active');
    });
    const sp = document.getElementById('spaceKey');
    if(!running && !levelComplete) sp.classList.add('active'); else sp.classList.remove('active');
  }
  function randomNext(){ target=setLetters[Math.floor(Math.random()*setLetters.length)]; }
  function spawn(){ const w=arena.clientWidth||800; x=w-RIGHT_PAD; randomNext(); fly.textContent=target; fly.style.left=x+'px'; highlight(); }

  function setLevel(n){ isBonus=false; level=n; setLetters=lettersForLevelNum(n); setHint.textContent='–í —ç—Ç–æ–º –±–ª–æ–∫–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±—É–∫–≤—ã: '+setLetters.join(' '); lastTs=null; resetRound(); updateLevelLocks(); highlight(); saveProgress(); }
  function setBonus(){ isBonus=true; setLetters=lettersForPassed(unlockedLevelMax); setHint.textContent='–ë–æ–Ω—É—Å ‚àû: –±—É–∫–≤—ã –∏–∑ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π ‚Äî '+setLetters.join(' '); lastTs=null; resetRound(); updateLevelLocks(); highlight(); saveProgress(); }

  function start(){ if(running||levelComplete) return; if(lives<=0){ lives=START_LIVES; score=0; updateScore(); } running=true; arenaHint.style.display='none'; document.getElementById('spaceKey').classList.remove('active'); overlay.style.display='none'; lastTs=null; if(!req){ req=requestAnimationFrame(loop); } highlight(); }

  function gameOver(){ running=false; overlay.style.display='flex'; highlight(); overlayTitle.textContent='–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞'; finalScore.textContent='–í–∞—à —Å—á—ë—Ç: '+score; retryBtn.style.display='inline-block'; nextBtn.style.display='none'; }

  function updateScore(){
    scoreTag.textContent='–û—á–∫–∏: '+score;
    if(!isBonus && score>=10 && !levelComplete){
      levelComplete=true; running=false; arenaHint.style.display='none'; overlay.style.display='flex';
      highlight();
      if(level<5){ overlayTitle.textContent='–û—Ç–ª–∏—á–Ω–æ! –¢—ã –ø—Ä–æ—à—ë–ª —É—Ä–æ–≤–µ–Ω—å!'; finalScore.textContent='–û—á–∫–∏: '+score; retryBtn.style.display='none'; nextBtn.style.display='inline-block'; nextBtn.textContent='–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π'; if(unlockedLevelMax===level) unlockedLevelMax=Math.min(5,unlockedLevelMax+1); }
      else { overlayTitle.textContent='–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¢—ã –ø—Ä–æ—à—ë–ª –≤—Å–µ —É—Ä–æ–≤–Ω–∏!'; finalScore.textContent='–ú–æ–∂–µ—à—å –∏–≥—Ä–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ!'; retryBtn.style.display='none'; nextBtn.style.display='inline-block'; nextBtn.textContent='–ü–µ—Ä–µ–π—Ç–∏ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π'; unlockedLevelMax=6; }
      updateLevelLocks(); saveProgress();
    }
  }

  function handleInput(ch){ if(!running) return; if(up(ch)===target){ score+=1; updateScore(); spawn(); } }

  function loop(ts){ if(!running){ req=requestAnimationFrame(loop); return; } if(lastTs==null) lastTs=ts; const dt=(ts-lastTs)/1000; lastTs=ts; x-=(SPEED[isBonus?6:level]||120)*dt; fly.style.left=x+'px'; if(x<=8){ lives-=1; renderLives(); if(lives<=0){ gameOver(); spawn(); } else { spawn(); } } req=requestAnimationFrame(loop); }

  function resetRound(){ lives=START_LIVES; score=0; levelComplete=false; renderLives(); running=false; arenaHint.style.display='block'; document.getElementById('spaceKey').classList.add('active'); spawn(); }

  // Events
  window.addEventListener('keydown', e=>{ if(e.code==='Space'){ e.preventDefault(); start(); } else { handleInput(e.key); } });
  document.querySelectorAll('[data-level]').forEach(btn=> btn.addEventListener('click', ()=> setLevel(+btn.dataset.level)));
  const bonusBtn=document.querySelector('[data-bonus]'); if(bonusBtn) bonusBtn.addEventListener('click', ()=> setBonus());
  retryBtn.addEventListener('click', ()=>{ overlay.style.display='none'; resetRound(); });
  nextBtn.addEventListener('click', ()=>{ if(level<5){ setLevel(level+1); } else { setBonus(); } overlay.style.display='none'; resetRound(); });

  // Init
  renderLives(); loadProgress(); setLevel(level); updateLevelLocks(); applyKbdScale();
  arenaHint.style.display='block'; document.getElementById('spaceKey').classList.add('active'); req=requestAnimationFrame(loop);
})();
</script>
</body>
</html>
